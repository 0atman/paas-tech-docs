# Amazon S3

Amazon S3 provides object storage through a web service interface.

<h2 id="set-up-the-service">Set up the service</h2>

### Provision an Amazon Web Service S3 bucket

To create a service instance, you must provision an Amazon Web Service (AWS) S3 bucket.

The name of the service overall is `aws-s3-bucket`. There is one type of plan for the service, named `default`. This plan is unlimited in terms of data you can download, storage, and resource in general.

#### Provision a private AWS S3 bucket

By default, S3 buckets you provision are private and not accessible to everyone through the internet.

Run the following in the command line to provision a private AWS S3 bucket:

```
cf create-service aws-s3-bucket default SERVICE_NAME
```

where `SERVICE_NAME` is a unique descriptive name for this S3 bucket.

#### Provision a public AWS S3 bucket

You can provision S3 buckets so they are publicly accessible to everyone through the internet.

Possible use cases for public S3 buckets include:

- storing static objects that you do not want to include with your app
- hosting `404` error pages that work independently of your app

Run the following in the command line to provision a public AWS S3 bucket:

```
cf create-service aws-s3-bucket default SERVICE_NAME -c '{"ram_gb":4}'
```
where `SERVICE_NAME` is a unique descriptive name for this S3 bucket.

### Bind an AWS S3 bucket to your app

You must bind the S3 bucket to your app so you can access the bucket from the app.

You can bind your app using the command line or the manifest. We recommend that you use the command line because you can specify the permissions for the S3 bucket. S3 buckets have read/write permissions by default.

_is it that you have read/write permissions? or all people with the app? or the app?_

Run the following to bind the S3 bucket to your app, selecting the appropriate permission level:

```
cf bind-service APP_NAME SERVICE_NAME -c '{"permissions": "read-write/read-only"}'
```

where:

- `APP_NAME` is the name of a deployed instance of your application (as specified in your app's `manifest.yml` file or push command)
- `SERVICE_NAME` is a unique descriptive name for this S3 bucket

You can use the [app's manifest](https://docs.cloud.service.gov.uk/deploying_apps.html#deploying-public-apps) to bind S3 bucket to the app. It will bind automatically when you next deploy your app. An example manifest:

```
--
applications:
- name: APP_NAME
  services:
  - SERVICE_NAME
```

### Connect to an S3 bucket from your app

Restart your app to populate your `VCAP_SERVICES` [environment variable](/deploying_apps.html#system-provided-environment-variables) with the credentials needed to connect to the S3 bucket.

When this is complete, you can connect your app to the S3 bucket using an appropriate method for your implementation.

Refer to the [Pivotal documentation on the VCAP_SERVICES environment variable](https://docs.run.pivotal.io/devguide/deploy-apps/environment-variable.html#VCAP-SERVICES) for more information.

### Connect to an S3 bucket from your local machine

_Needs clarification_

currently covered by service key stuff, might need conduit content in future depending on that story

dependent on implementation of `{allowexternal:true}` story - in progress

- Create a service key or is that separate?

when you bind an app to your bucket, cloud foundry creates a user that is unique to the binding of the app and the bucket. you can create a user that is only unique to the bucket, for example if you want to access the bucket from a local machine. to do this, you create a service key - link to the cloud foundry docs (https://docs.cloudfoundry.org/devguide/services/service-keys.html)

public and private on a per-binding basis

For bindable services, Cloud Foundry adds connection details to the VCAP_SERVICES environment variable when you restart your app, after binding a service instance to your app.

_Needs clarification_

<h2 id="amend-the-service">Amend the service</h2>

You can take different actions on your S3 bucket using the [S3 API](https://docs.aws.amazon.com/cli/latest/reference/s3api/). The actions you are allowed to take depend on your permission level for that bucket.

<div style="height:1px;font-size:1px;">&nbsp;</div>

|Description|Command|Permission|
|:---|:---|:---|
|Download an object from S3 bucket|`s3:GetObject`|Read-write, Read-only|
|Upload an object to S3 bucket|`s3:PutObject`|Read-write|
|Delete an object from S3 bucket|`s3:DeleteObject`|Read-write|
|Get AWS region of S3 bucket|`s3:GetBucketLocation`|Read-write, Read-only|
|List objects in S3 bucket|`s3:ListBucket`|Read-write, Read-only|

<div style="height:1px;font-size:1px;">&nbsp;</div>

<h2 id="remove-the-service">Remove the service</h2>

You remove the service by deleting the S3 bucket. To delete a bucket, that bucket must not:

- contain any objects
- be bound to any apps
- contain a service key

### Delete objects from the bucket

Use the [S3 API](https://docs.aws.amazon.com/cli/latest/reference/s3api/) to delete objects from the bucket.

You can do this with both read-write and read-only permissions.

### Unbind an S3 bucket from your app

Run the following in the command line to unbind the S3 bucket from the app:

```
cf unbind-service APP_NAME SERVICE_NAME
```

where:

- `APP_NAME` is the name of a deployed instance of your application (as specified in your app's `manifest.yml` file or push command)
- `SERVICE_NAME` is a unique descriptive name for this S3 bucket

If you unbind your services from your app but do not delete them, the services will persist even after your app is deleted, and you can re-bind or re-connect to them in future.

### Delete service key

Run the following in the command line to delete the service key:

```
cf delete-service-key SERVICE_NAME
```

https://docs.cloudfoundry.org/devguide/services/service-keys.html#delete

### Delete an S3 bucket

You can delete an S3 bucket once you have:

- deleted all objects and the service key from that bucket
- unbound that bucket from all apps

Run the following in the command line to delete the S3 bucket:

```
cf delete-service SERVICE_NAME
```

where `SERVICE_NAME` is a unique descriptive name for this S3 bucket.

Type `yes` when asked for confirmation.

<h2 id="maintaining-the-service">Maintaining the service</h2>

___anything here?___

___any supporting information we should link to?___

### Maintenance and backups??

### Use GUI tool to browse, upload and download files in S3??


files could be deleted using GUI and service key
